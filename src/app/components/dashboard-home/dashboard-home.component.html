<!-- Push modal -->
<div class="modal fade" id="pushModal" tabindex="-1" role="dialog" aria-labelledby="pushModalLabel"
  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="pushModalLabel">Synchronize a specific EP</h5>
        <button type="button" class="close" #closeModalButton data-dismiss="modal" aria-label="Close"
          (click)="cleanModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form [formGroup]="pushForm">

          <div class="row">
            <label for="name" class="col-sm-4 col-form-label">EXPA ID</label>
            <div class="col-sm-8">
              <input type="text" class="form-control" id="id" placeholder="EXPA ID" required formControlName="expa_id" />
            </div>
          </div>

        </form>

        <div class="alert alert-danger" role="alert" *ngIf="errorMsg">
          {{ errorMsg }}
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="cleanModal()">
          Close
        </button>
        <button type="button" class="btn btn-primary" [disabled]="submitting || pushForm.pristine" (click)="submitModal()">
          <i *ngIf="submitting" class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i>Synchronize
        </button>
      </div>
    </div>
  </div>
</div>

<div class="container mt-5">
  <h2>Hi<ng-container *ngIf="meName">, {{ meName }}!</ng-container></h2>

  <div class="mt-4">
    <h4>Latest updates to Trello</h4>

    <ng-container *ngIf="LOGS; else loading">
      
      <ng-container *ngIf="logs.length; else noLogs">
        <table class="table mt-3">
          <thead class="thead-dark">
            <tr>
              <th scope="col">#</th>
              <th scope="col">New signups</th>
              <th scope="col">Timestamp</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let log of logs">
              <th scope="row">{{ log.id }} </th>
              <td>{{ log.n | number }}</td>
              <td>{{ log.stamp | date: 'dd.MM.yyyy HH:mm' }}</td>
              <td [ngClass]="{'text-success': log.success == 1, 'text-danger': log.success == 0}">
                {{ log.success == 1 ? 'Success' : 'Failure' }}
              </td>
            </tr>
          </tbody>
        </table>

        <div class="d-flex justify-content-between p-2 pagination-secondary">
          <ngb-pagination [collectionSize]="logsLen" [(page)]="logsPage" [pageSize]="logsPageLen"
            [maxSize]="5" [rotate]="true" [ellipses]="false" [boundaryLinks]="true">
          </ngb-pagination>
        
          <select class="custom-select" style="width: auto" [(ngModel)]="logsPageLen">
            <option [ngValue]="5">Show 5 lines</option>
            <option [ngValue]="10">Show 10 lines</option>
            <option [ngValue]="20">Show 20 lines</option>
            <option [ngValue]="50">Show 50 lines</option>
          </select>
        </div>

      </ng-container>

      <ng-template #noLogs>
        <p>There are no logs yet.</p>
      </ng-template>

      <p class="text-black-50 mt-5">
        The EXPA database is synchronized with Trello once a day every day. Press one of the buttons below to synchronize now.
      </p>

      <button type="button" class="btn btn-outline-primary mr-2" [disabled]="submitting" (click)="push()">
        <i *ngIf="submitting" class="fa fa-spinner fa-spin" style="margin-right: 5px;"></i> Synchronize</button>

      <button type="button" class="btn btn-outline-secondary" data-toggle="modal" data-target="#pushModal">
        Synchronize specific EP</button>

      <div class="alert alert-danger mt-2" role="alert" *ngIf="errorMsg">
        {{ errorMsg }}
      </div>

    </ng-container>

    <ng-template #loading>
      <p>Loading...</p>
    </ng-template>

  </div>



</div>